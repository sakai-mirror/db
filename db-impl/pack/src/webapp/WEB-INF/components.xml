<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>

	<bean id="org.sakaiproject.db.api.SqlService"
			class="org.sakaiproject.db.impl.BasicSqlService"
			init-method="init" destroy-method="destroy" singleton="true">

		<lookup-method name="usageSessionService" bean="org.sakaiproject.event.api.UsageSessionService" />
		<lookup-method name="threadLocalManager" bean="org.sakaiproject.thread_local.api.ThreadLocalManager" />

		<property name="defaultDataSource">
			<ref bean="javax.sql.DataSource" />
		</property>
		
		<property name="longDataSource">
			<ref bean="javax.sql.DataSource" />
		</property>
		
		<property name="autoDdl">
			<value>${auto.ddl}</value>
		</property>

		<property name="commitAfterRead">
			<value>false</value>
		</property>
		
		<!-- HSQLDB configuration -->
		<property name="vendor">
			<value>hsqldb</value>
		</property>

	</bean>

	 <bean id="javax.sql.BaseDataSource" abstract="true"
                class="com.mchange.v2.c3p0.ComboPooledDataSource"
                destroy-method="close">



                <!-- The connection URL to be passed to our JDBC driver to establish a connection. -->
                <property name="jdbcUrl">
                        <value></value>
                </property>

                <!-- The connection username to be passed to our JDBC driver to establish a connection. -->
                <property name="user">
                        <value>sa</value>
                </property>

                <!-- The connection password to be passed to our JDBC driver to establish a connection. -->
                <property name="password">
                        <value></value>
                </property>
                
                <property name="driverClass">
                        <value></value>
                </property>
                
                <property name="initialPoolSize">
                        <value>3</value>
                </property>
                
                <property name="minPoolSize">
                        <value>5</value>
                </property>
                
                <property name="maxPoolSize">
                        <value>50</value>
                </property>
                
                <property name="acquireIncrement">
                        <value>3</value>
                </property>
                
                <property name="acquireRetryAttempts">
                        <value>30</value>
                </property>
                
                <property name="acquireRetryDelay">
                        <value>1000</value>
                </property>
                
                <property name="idleConnectionTestPeriod">
                        <value>600</value>
                </property>
                
                 <property name="autoCommitOnClose">
                        <value>false</value>
                </property>
                
                <property name="preferredTestQuery">
                        <value>SELECT 1 FROM DUAL</value>
                </property>
                
                <property name="loginTimeout">
                        <value>30</value>
                </property>
                
                <property name="maxStatements">
                        <value>0</value>
                </property>
                
                <property name="maxStatementsPerConnection">
                        <value>0</value>
                </property>
                
                
                
                
    </bean>
	
	<!-- Shared DataSource for all pooled database connections -->
	<bean id="javax.sql.DataSource" parent="javax.sql.BaseDataSource">
	</bean>


	<!-- Base Hibernate SessionFactory -->
	<bean
			id="org.sakaiproject.springframework.orm.hibernate.SessionFactoryBase"
			abstract="true"
			class="org.springframework.orm.hibernate3.LocalSessionFactoryBean">
	
		<property name="dataSource">
			<ref local="javax.sql.DataSource" />
		</property>
		
		<property name="hibernateProperties">
			<props>
				<prop key="hibernate.dialect">${hibernate.dialect}</prop>
				<prop key="hibernate.query.factory_class">org.hibernate.hql.ast.ASTQueryTranslatorFactory</prop>
				<prop key="hibernate.show_sql">${hibernate.show_sql}</prop>
				<prop key="hibernate.query.substitutions">
					true 1, false 0, yes 'Y', no 'N'
				</prop>
				<prop key="hibernate.jdbc.use_streams_for_binary">true</prop>
				<prop key="hibernate.cache.use_query_cache">true</prop>
				<prop key="hibernate.cache.provider_class">
					org.hibernate.cache.EhCacheProvider
				</prop>
			</props>
		</property>
		
		<!--  update the database schema when starting -->
		<property name="schemaUpdate">
			<value>${auto.ddl}</value>
		</property>
	
	</bean>

	<!--  The "Global" Hibernate Session Factory -->
	<bean
			id="org.sakaiproject.springframework.orm.hibernate.GlobalSessionFactory"
			parent="org.sakaiproject.springframework.orm.hibernate.SessionFactoryBase"
			class="org.sakaiproject.springframework.orm.hibernate.AddableSessionFactoryBean">
	</bean>

	<!--  The "Global" Transaction Manager -->
	<bean
			id="org.sakaiproject.springframework.orm.hibernate.GlobalTransactionManager"
			class="org.springframework.orm.hibernate3.HibernateTransactionManager">
		<property name="sessionFactory">
			<ref bean="org.sakaiproject.springframework.orm.hibernate.GlobalSessionFactory" />
		</property>
	</bean>

</beans>
